 <!-- Open in Chrome -->
 <!DOCTYPE html>
 <html>
	<head>
		<title>Felipes Test</title>

	    <script src="https://xyz.api.here.com/maps/latest/xyz-maps-common.min.js" type="text/javascript" charset="UTF-8" ></script>
	    <script src="https://xyz.api.here.com/maps/latest/xyz-maps-core.min.js" type="text/javascript" charset="UTF-8" ></script>
	    <script src="https://xyz.api.here.com/maps/latest/xyz-maps-display.min.js" type="text/javascript" charset="UTF-8" ></script>
	    <script src="https://xyz.api.here.com/maps/latest/xyz-maps-plugins.min.js" type="text/javascript" charset="UTF-8" ></script>

 		<style type="text/css">
			#map {
				position: absolute;
            	overflow: hidden;
				top: 0;
				left: 0;
				width: 100%;
                height: 100%;
				z-index: -1;
			}
			
			body {
				padding: 26px 10px;
			}
		
			.button {
				position: relative;
				right: 0;
				top: 0;
				padding: 8px;
				border-radius: 9px;
				width: 200px;
				text-align: center;
				font-weight: bold;
				font-family: sans-serif;
				float: left;
				margin-right: 20px;
				cursor: pointer;
			}
			
			.button:hover{
				opacity: .8;
			}
			
			#logistics {				
				background-color: rgba(0, 0, 0, .6);
				color: #fff;				
				border: 1px solid #fff;
			}
			
			#earthquake {				
				background-color: rgba(255, 0, 0, 0.6);
				color: #fff;	
				border: 1px solid #fff;
			}
			#floods {
				background-color: rgba(0, 68, 247, .6);
				color: #fff;				
				border: 1px solid #fff;
			}
			#storms {
				background-color: rgba(105, 105, 105, .6);
				color: #fff;				
				border: 1px solid #fff;
			}
			
			.properties {
				position:relative;
				top:0;			
			}
			
			.controls {
				overflow: hidden;
				margin-bottom: 20px;
			}
			
			.panel {
				width: 650px;
				float: left;
			}
			
			#info {
				background: #272d37;
				color: #fff;
				max-height: 380px;
				overflow-y: scroll;
				padding: 20px 5px;
			}
			
			#legend {
				position: absolute;
				bottom: 0;
				left: 0;
				background-color: rgba(0, 0, 0, .6);
				color: #fff;				
				border: 1px solid #fff;
				margin: 20px 5px;
				text-align: center;
				font-weight: bold;
				font-family: sans-serif;
				width: auto;
			}
 		</style>
	</head>
	<body>
		<div id="map"></div>

		
		<div class="panel">
			<div class="controls"> 
				<div id="logistics" class="button">Logistics mode</div>
				<div id="earthquake" class="button">Earthquake mode</div>
				<div id="floods" class="button">Flood mode</div>
				<div id="storms" class="button">Storm mode</div>
			</div>
			
			<div id="info" class="properties">No feature is clicked!</div>
		</div>
		<div id="legend" class="">Legend</div>

		<script type="application/javascript">

			//specify your credentials for image and link layers
			var infoTag = document.querySelector("#info");
			var acc = 'AbynnjJw1kaHrFGPTZqce1k';
			var mini = 0;
			var maxi = 25;

        // add layers to display
        var layers = [
            new here.xyz.maps.layers.MVTLayer({
                name   : 'mvt-world-layer',
                remote : {
                    url : 'https://xyz.api.here.com/tiles/osmbase/256/all/{z}/{x}/{y}.mvt?access_token='+acc
                    // optional settings:
                    // max  : 16,     // max level for loading data
                    // min  : 1       // min level for loading data
                    // tileSize : 512 // 512|256 defines mvt tilesize in case it can't be automatically detected in url..
                },
                min : 1,
                max : 16,

                style : {

                    backgroundColor: '#555555',

                    strokeWidthZoomScale: function (level) {
                        return level > 17 ? 1 : level > 14 ? .5 : .25
                    },

                    styleGroups: {

                        'earth'        : [{ zIndex: 0, type: 'Polygon', fill: '#555555' }],
                        'water'        : [{ zIndex: 0, type: 'Polygon',opacity:0.3, fill: '#7ffcfc' }],
                        'landuse'      : [{ zIndex: 0, type: 'Polygon', fill: '#666666' }],
                        'roads'        : [{ zIndex: 0, type: 'Line',  stroke: '#ffffff', strokeWidth: 4 }],
                        'roadshighway' : [{ zIndex: 0, type: 'Line',  stroke: '#ffffff', strokeWidth: 6 }],
                        'buildings'    : [{ zIndex: 0, type: 'Polygon', fill: '#999999' }]
                    },

                    assign: function (feature, level)
                    {
                        var props = feature.properties;
                        var kind  = props.kind;
                        var layer = props.layer; // the data layer of the feature
                        var geom  = feature.geometry.type;

                        if (layer == 'water') {
                            if (geom == 'LineString' || geom == 'MultiLineString') {
                                return;
                            }
                        }
                        if (layer == 'roads') {
                            if (kind == 'rail' || kind == 'ferry') {
                                return;
                            }
                            if (kind == 'highway') {
                                return layer + kind;
                            }
                        }
                        return layer;
                    }
                }
            })
        ];

		window.display = new  here.xyz.maps.Map( document.getElementById("map"), {
        zoomLevel : 2,
        center: {
            longitude: -96.76883, latitude: 39.6104
		},
		layers: layers});

		layers[0].pointerEvents(false);

		// add event listener to pointerenter
		display.addEventListener('pointerenter', function(evt){
			// set feature style when pointer enters feature
			var targetstyle = evt.detail.layer.getStyle().styleGroups.linkStyle[0];
			//console.log(evt.detail.layer.getStyle().styleGroups.linkStyle[0].radius);
			var hoverStyleVol = [
				{zIndex:1, type:"Circle",radius:targetstyle.radius*3, fill: targetstyle.fill},
			];
			if(evt.target)
				evt.detail.layer.setStyleGroup(evt.target, hoverStyleVol);
		});

		// add event listener to pointerleave
		display.addEventListener('pointerleave', function(evt){
			// restore feature style when pointer leaves feature
			if(evt.target)
				evt.detail.layer.setStyleGroup(evt.target);
		});

//Layer Style Setter
function setEarthquakeRadius(feature, zoomlevel) {
	return Math.floor(feature.properties.mag)*2;
}

function setVolColor(feature, zoomlevel) { //set color of volcanoe
	if (feature.properties.TYPE == "Active" || feature.properties.TYPE == "Potentially active") {
		return "#ff0000";
	}
	else {
		return "#000000";
	}
}

//Layer Definition
var floodRiskAreas = new here.xyz.maps.layers.TileLayer({
	name: 'Flood Risk Areas',
    min: mini,
    max: maxi,

    // Define provider for this layer
    provider: new here.xyz.maps.providers.SpaceProvider ({
    	// Name of the provider
		name:  'SpaceProvider',

		// Zoom level at which tiles are cached
		level: 4,

		// Space name
		space: 'jOVvBmeh',

		// User credential of the provider
		credentials: {
            access_token: acc
		}
			}),

    // customize layer style
    style:{
    	styleGroups: {
    		linkStyle: [
				{zIndex:0, type:"Polygon", opacity:0.3, fill:"#ff0450"},
				]
    	},

		assign: function(feature, zoomlevel){
         	return "linkStyle";
		}
    }

})

var earthquakes = new here.xyz.maps.layers.TileLayer({
	// Name of the layer
	name: 'Significant Earthquakes Last Month',
    min: maxi,
    max: mini,

    // Define provider for this layer
    provider: new here.xyz.maps.providers.SpaceProvider ({
    	// Name of the provider
		name:  'SpaceProvider',

		// Zoom level at which tiles are cached
		level: 4,

		// Space name
		space: 'hvRHTYsy',

		// User credential of the provider
		credentials: {
            access_token: acc
		}
			}),

    // customize layer style
    style:{
    	styleGroups: {
    		linkStyle: [
				{zIndex:1, type:"Circle",radius:setEarthquakeRadius, opacity:0.5, fill:"#ff0450"},
				{zIndex:2, type:"Text", textRef:"properties.mag", fill:"#3D272B"}
				]
    	},

		assign: function(feature, zoomlevel){
         	return "linkStyle";
		}
    }

})

var volcanoes = new here.xyz.maps.layers.TileLayer({
	// Name of the layer
	name: 'Global Volcanoes',
    min: mini,
    max: maxi,
    provider: new here.xyz.maps.providers.SpaceProvider ({
    	// Name of the provider
		name:  'SpaceProvider',

		// Zoom level at which tiles are cached
		level: 4,

		// Space name
		space: 'UuVkYCwS',

		// User credential of the provider
		credentials: {
            access_token: acc
		}
			}),

    // customize layer style
    style:{
    	styleGroups: {
    		linkStyle: [
				{zIndex:1, type:"Circle",radius:4, opacity:1.0,fill:setVolColor}
				]
    	},

		assign: function(feature, zoomlevel) {
         	return "linkStyle";
		}
    }

})

var dams = new here.xyz.maps.layers.TileLayer({
	name: 'Dams and Water Reservoirs',
    min: mini,
    max: 10,

    // Define provider for this layer
    provider: new here.xyz.maps.providers.SpaceProvider ({
    	// Name of the provider
		name:  'SpaceProvider',

		// Zoom level at which tiles are cached
		level: 4,

		// Space name
		space: 'Wl49aIk5',

		// User credential of the provider
		credentials: {
            access_token: acc
		}
			}),

    // customize layer style
    style:{
    	styleGroups: {
    		linkStyle: [
				{zIndex:1, type:"Circle",radius:2, opacity:0.8, fill:"#042aff"},
				//{zIndex:2, type:"Text", textRef:"", fill:"#3D272B"}
				]
    	},

		assign: function(feature, zoomlevel){
         	return "linkStyle";
		}
    }

})

//logistics
var airports = new here.xyz.maps.layers.TileLayer({
	name: 'Global Airports',
    min: mini,
    max: maxi,
    provider: new here.xyz.maps.providers.SpaceProvider ({
    	// Name of the provider
		name:  'SpaceProvider',

		// Zoom level at which tiles are cached
		level: 4,

		// Space name
		space: 'xDBZAPBf',
		credentials: {
            access_token: acc
		}
			}),
	style:{
      styleGroups: {
        linkStyle: [{
          type: "Image",
          zIndex: 0,
		  width: 10,
		  fill: "#fffff",
          src: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAABmJLR0QA/wD/AP+gvaeTAAABqUlEQVRIie2UvStGYRjGr+d9X19ZMKFkMJmEUEwGH2UxS8rsH5AS/4EyKpMwkYGUsimLFDEYDEoJYSBfb/wsJx6P8/G+x3lNrjrD89z3uX73fXfuI/0rpoAiYBw4ADYKDasBdvnSSSFhjcAZ3zVVKFgXcOPAjoCyQsAGgUcHdgU02HkZ56UmSfOSaiVVSLIre5b0ZJ0fJGWtc72ktBMfMMacBlU4ADyQjF6Bfj9O2oMZSW2SkFQtqTxgcrkISaPGmFW/oPHpNCWpWVKPpF5JXZKK8wCeG2PqYhT6WUAGaAWmgT3gLWKcF7FhAQV0AM8hwOskYZXAcUSHd0nBMsCmz9fo6j4JmAGWHeN9oBl4d+6foh2jgROO6Q5Q5cXcEWej/GzjUmAWWADGgBZgxOliFevfCMz4jPXHuoVBizxTP027ZkDfr4CeSQmw4ZhMBuSW83NNUnkBrU5XLJPukNytXIGBAWNMVtKQpHXvqj2kvm2b7z3xBKSBJWAtJKfJ6u42NswyLAbmQuIp4NIDHv4aaEHTIfFF4AXoTASYQ0EjwPCfwDxgfrv3V/oA2G3jN0eGPewAAAAASUVORK5CYII="}]
	  },
      assign: ()=>"linkStyle"
    }
})

var hospitals = new here.xyz.maps.layers.TileLayer({
	name: 'Global Medical Support',
    min: mini,
    max: 10,
    provider: new here.xyz.maps.providers.SpaceProvider ({
		name:  'SpaceProvider',
		level: 6,
		space: '3IiQm9PL',

		// User credential of the provider
		credentials: {
            access_token: acc
		}
			}),

    // customize layer style
    style:{
    	styleGroups: {
    		linkStyle: [
				{zIndex:1, 
				type:"Image",
				width: 10,
				src: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAABmJLR0QA/wD/AP+gvaeTAAABFElEQVRIie2VvUrEQBRGzyeClcKCWIm2YmnnQ4jYiwjW2+Q1xM5GWNBKkG1ttNNeLCysLPx5CBH1s3CzjmM27MZJitUDgXw3zD3kTshAwyi/sb0ObAGLCfu/AXfAnqSrftX2puvl2fYKwETPmSV8qyKmgHYonK9ZCLAQChtjssKaY+AxyDvAbJ3CA0mXebC9Noqw8ZH+C5NT9tF0gPOC+m2UM2Amqgk4GVV4Lalb8vyzs3QW12wPnNzf3sO27Y2CeibpJg+2O/w80sQAyoRLvSumFeVVYLmkzzfGfw/HX1jleDq1/Rrk+C+TXDhdYU2ffKRPv2kyJA+h8LBm2TtwBF8j3QdegG1gLrHsHtiVdJG473B8ANWnlE/fR3QJAAAAAElFTkSuQmCC",
				fill:"#ffffff"
				},
				]
    	},

		assign: function(feature, zoomlevel){
         	return "linkStyle";
		}
    }

})

var ports = new here.xyz.maps.layers.TileLayer({
	name: 'Global Ports',
    min: mini,
    max: maxi,

    // Define provider for this layer
    provider: new here.xyz.maps.providers.SpaceProvider ({
    	// Name of the provider
		name:  'SpaceProvider',
		level: 6,
		space: 'oJOniQdl',

		// User credential of the provider
		credentials: {
            access_token: acc
		}
			}),

    // customize layer style
    style:{
    	styleGroups: {
    		linkStyle: [
				{zIndex:2, type:"Circle",radius:3, opacity:1.0, fill:"#00008B"},
				]
    	},

		assign: function(feature, zoomlevel){
         	return "linkStyle";
		}
    }

})

var cyclones = new here.xyz.maps.layers.TileLayer({
	name: 'Historic Cyclone Paths',
    min: mini,
    max: maxi,

    // Define provider for this layer
    provider: new here.xyz.maps.providers.SpaceProvider ({
    	// Name of the provider
		name:  'SpaceProvider',
		level: 6,
		space: 'CNrmfmb8',

		// User credential of the provider
		credentials: {
            access_token: acc
		}
			}),

    // customize layer style
    style:{
    	styleGroups: {
    		linkStyle: [{ zIndex: 2, type: 'Line', fill:"#00fffb" , stroke: '#97ffff', strokeWidth: 6 }]
    	},

		assign: function(feature, zoomlevel){
         	return "linkStyle";
		}
    }

})

//Logistics Mode on off
var logisticsAdded = false;
document.querySelector("#logistics").onclick = function(){

	if(!logisticsAdded){
		display.addLayer(ports);
		display.addLayer(airports);
		display.addLayer(hospitals);

		this.innerText="End logistics mode";
		updateLegend();
		logisticsAdded = true;
	}
	else{
		display.removeLayer(ports);
		display.removeLayer(airports);
		display.removeLayer(hospitals);

		this.innerText="Logistics mode";
		updateLegend();
		logisticsAdded = false;
	}
};

//Earthquake Mode on off
var earthquakeAdded = false;
document.querySelector("#earthquake").onclick = function(){

	if(!earthquakeAdded){
		display.addLayer(dams);
		display.addLayer(earthquakes);
		display.addLayer(volcanoes);

		this.innerText="End earthquake mode";
		updateLegend();
		earthquakeAdded = true;
	}
	else{
		display.removeLayer(dams);
		display.removeLayer(earthquakes);
		display.removeLayer(volcanoes);

		this.innerText="Earthquake mode";
		updateLegend();
		earthquakeAdded = false;
	}
};

//Flood Mode on off
var floodAdded = false;
document.querySelector("#floods").onclick = function(){

	if(!floodAdded){
		display.addLayer(floodRiskAreas);

		this.innerText="End flood mode";
		updateLegend();
		floodAdded = true;
	}
	else{
		display.removeLayer(floodRiskAreas);

		this.innerText="Flood mode";
		updateLegend();
		floodAdded = false;
	}
};

//Flood Mode on off
var stormAdded = false;
document.querySelector("#storms").onclick = function(){

	if(!stormAdded){
		display.addLayer(cyclones);

		this.innerText="End storm mode";
		updateLegend();
		stormAdded = true;
	}
	else{
		display.removeLayer(cyclones);

		this.innerText="Storm mode";
		updateLegend();
		stormAdded = false;
	}
};

// Add a event listener to pointerup
function eventHandler(evt){
	// Click on a feature
	if(evt.target){
		var properties = evt.target.properties;
		
		var bbox = evt.target.bbox;
		display.setCenter((bbox[0]+bbox[2])/2, (bbox[1]+bbox[3])/2);
		
		for (prop in properties){
			if (properties[prop] == null) {
				delete properties[prop];
			}
		}
		// Display feature user properties
		infoTag.innerText = JSON.stringify(properties, undefined, 4);
	}
	// Feature is not clicked
	else{
		infoTag.innerText = "No feature is clicked!";
	}
}

function updateLegend() {

legend.innerText = '';
var theseLayers = display.getLayers();
var legendString = "Legend";
if (theseLayers.length >= 1) {
	for (i = 1; i < theseLayers.length; i++) {		
		var el= document.createElement('div');
		el.innerText = theseLayers[i].name;
		el.style.color=theseLayers[i].getStyle().styleGroups.linkStyle[0].fill;
		legend.appendChild(el);
	}
}
}

display.addEventListener('pointerup', eventHandler);
		</script>
	</body>
</html>
